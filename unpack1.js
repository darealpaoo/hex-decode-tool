R=reformat=function(r,e){var t,n,_,T,a,K,i,E,O,c,f,R,h,u,l,o,A,N,s,g,L,S,P;r=C(r);var v=(e=e||{}).indent_size||4,d=e.indent_char||" ",p=void 0===e.preserve_newlines||e.preserve_newlines,B=e.indent_level||0;function D(){for(;n.length&&(" "===n[n.length-1]||n[n.length-1]===O);)n.pop()}function I(r){if(r=void 0===r||r,S=!1,D(),n.length){"\n"===n[n.length-1]&&r||n.push("\n");for(var e=0;e<P;e+=1)n.push(O)}}function W(){var r=" ";n.length&&(r=n[n.length-1])," "!==r&&"\n"!==r&&r!==O&&n.push(" ")}function w(){n.push(_)}function b(){P+=1}function M(){P&&(P-=1)}function X(r){E.push(i),i=r}function k(){s="DO_BLOCK"===i,i=E.pop()}function $(r,e){for(var t=0;t<e.length;t+=1)if(e[t]===r)return!0;return!1}function m(){var r=0;if(h>=t.length)return["","TK_EOF"];var e=t.charAt(h);for(h+=1;$(e,c);){if(h>=t.length)return["","TK_EOF"];"\n"===e&&(r+=1),e=t.charAt(h),h+=1}var n=!1;if(p){if(r>1)for(var _=0;_<2;_+=1)I(0===_);n=1===r}if($(e,f)){if(h<t.length)for(;$(t.charAt(h),f)&&(e+=t.charAt(h),(h+=1)!==t.length););if(h!==t.length&&e.match(/^[0-9]+[Ee]$/)&&("-"===t.charAt(h)||"+"===t.charAt(h))){var K=t.charAt(h);return h+=1,[e+=K+m()[0],"TK_WORD"]}return"in"===e?[e,"TK_OPERATOR"]:(n&&"TK_OPERATOR"!==T&&!S&&I(),[e,"TK_WORD"])}if("("===e||"["===e)return[e,"TK_START_EXPR"];if(")"===e||"]"===e)return[e,"TK_END_EXPR"];if("{"===e)return[e,"TK_START_BLOCK"];if("}"===e)return[e,"TK_END_BLOCK"];if(";"===e)return[e,"TK_SEMICOLON"];if("/"===e){var i="";if("*"===t.charAt(h)){if((h+=1)<t.length)for(;("*"!==t.charAt(h)||!t.charAt(h+1)||"/"!==t.charAt(h+1))&&h<t.length&&(i+=t.charAt(h),!((h+=1)>=t.length)););return h+=2,["/*"+i+"*/","TK_BLOCK_COMMENT"]}if("/"===t.charAt(h)){for(i=e;"\r"!==t.charAt(h)&&"\n"!==t.charAt(h)&&(i+=t.charAt(h),!((h+=1)>=t.length)););return h+=1,n&&I(),[i,"TK_COMMENT"]}}if("'"===e||'"'===e||"/"===e&&("TK_WORD"===T&&"return"===a||"TK_START_EXPR"===T||"TK_START_BLOCK"===T||"TK_END_BLOCK"===T||"TK_OPERATOR"===T||"TK_EOF"===T||"TK_SEMICOLON"===T)){var E=e,O=!1,u=e;if(h<t.length)for(;O||t.charAt(h)!==E;)if(u+=t.charAt(h),O=!O&&"\\"===t.charAt(h),(h+=1)>=t.length)return[u,"TK_STRING"];if(h+=1,u+=E,"/"===E)for(;h<t.length&&$(t.charAt(h),f);)u+=t.charAt(h),h+=1;return[u,"TK_STRING"]}if("#"===e){var l="#";if(h<t.length&&$(t.charAt(h),o)){do{l+=e=t.charAt(h),h+=1}while(h<t.length&&"#"!==e&&"="!==e);return"#"===e?[l,"TK_WORD"]:[l,"TK_OPERATOR"]}}if("<"===e&&"\x3c!--"===t.substring(h-1,h+3))return h+=3,["\x3c!--","TK_COMMENT"];if("-"===e&&"--\x3e"===t.substring(h-1,h+2))return h+=2,n&&I(),["--\x3e","TK_COMMENT"];if($(e,R)){for(;h<t.length&&$(e+t.charAt(h),R)&&(e+=t.charAt(h),!((h+=1)>=t.length)););return[e,"TK_OPERATOR"]}return[e,"TK_UNKNOWN"]}for(O="";v>0;)O+=d,v-=1;for(P=B,t=r,K="",T="TK_START_EXPR",a="",n=[],s=!1,g=!1,L=!1,c="\n\r\t ".split(""),f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),o="0123456789".split(""),R="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::".split(" "),u="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),E=[i="BLOCK"],h=0,l=!1;;){var x=m();if(_=x[0],"TK_EOF"===(N=x[1]))break;switch(N){case"TK_START_EXPR":g=!1,X("EXPRESSION"),";"===a?I():"TK_END_EXPR"===T||"TK_START_EXPR"===T||("TK_WORD"!==T&&"TK_OPERATOR"!==T?W():$(K,u)&&W()),w();break;case"TK_END_EXPR":w(),k();break;case"TK_START_BLOCK":X("do"===K?"DO_BLOCK":"BLOCK"),"TK_OPERATOR"!==T&&"TK_START_EXPR"!==T&&("TK_START_BLOCK"===T?I():W()),w(),b();break;case"TK_END_BLOCK":"TK_START_BLOCK"===T?(D(),M()):(M(),I()),w(),k();break;case"TK_WORD":if(s){W(),w(),W(),s=!1;break}if("case"===_||"default"===_){":"===a?n.length&&n[n.length-1]===O&&n.pop():(M(),I(),b()),w(),l=!0;break}A="NONE","TK_END_BLOCK"===T?$(_.toLowerCase(),["else","catch","finally"])?(A="SPACE",W()):A="NEWLINE":"TK_SEMICOLON"!==T||"BLOCK"!==i&&"DO_BLOCK"!==i?"TK_SEMICOLON"===T&&"EXPRESSION"===i?A="SPACE":"TK_STRING"===T?A="NEWLINE":"TK_WORD"===T?A="SPACE":"TK_START_BLOCK"===T?A="NEWLINE":"TK_END_EXPR"===T&&(W(),A="NEWLINE"):A="NEWLINE","TK_END_BLOCK"!==T&&$(_.toLowerCase(),["else","catch","finally"])?I():$(_,u)||"NEWLINE"===A?"else"===a?W():("TK_START_EXPR"!==T&&"="!==a&&","!==a||"function"!==_)&&("TK_WORD"!==T||"return"!==a&&"throw"!==a?"TK_END_EXPR"!==T?"TK_START_EXPR"===T&&"var"===_||":"===a||("if"===_&&"TK_WORD"===T&&"else"===K?W():I()):$(_,u)&&")"!==a&&I():W()):"SPACE"===A&&W(),w(),K=_,"var"===_&&(g=!0,L=!1),"if"!==_&&"else"!==_||(S=!0);break;case"TK_SEMICOLON":w(),g=!1;break;case"TK_STRING":"TK_START_BLOCK"===T||"TK_END_BLOCK"===T||"TK_SEMICOLON"===T?I():"TK_WORD"===T&&W(),w();break;case"TK_OPERATOR":var y=!0,F=!0;if(g&&","!==_&&(L=!0,":"===_&&(g=!1)),g&&","===_&&"EXPRESSION"===i&&(L=!1),":"===_&&l){w(),I();break}if("::"===_){w();break}if(l=!1,","===_){g?L?(w(),I(),L=!1):(w(),W()):"TK_END_BLOCK"===T?(w(),I()):"BLOCK"===i?(w(),I()):(w(),W());break}"--"===_||"++"===_?";"===a?(y=!0,F=!1):(y=!1,F=!1):"!"===_&&"TK_START_EXPR"===T?(y=!1,F=!1):"TK_OPERATOR"===T?(y=!1,F=!1):"TK_END_EXPR"===T?(y=!0,F=!0):"."===_?(y=!1,F=!1):":"===_&&(y=!!a.match(/^\d+$/)),y&&W(),w(),F&&W();break;case"TK_BLOCK_COMMENT":I(),w(),I();break;case"TK_COMMENT":W(),w(),I();break;case"TK_UNKNOWN":w()}T=N,a=_}return n.join("").replace(/\n+$/,"")},C=function(r){var e,t=!1,n=(r.match(/(^|\n|\W|\s|[,;])([_\$a-z1-9]+)=function\(i\)\{return (?:_d|document)\.getElementById\(i\)\}/i)||[])[2];return n&&(t=n+"=function\\(i\\)\\{return (?:_d|document)\\.getElementById\\(i\\)\\}",e=new RegExp(t,"gi"),r=r.replace(e,""),t="([^-.a-z1-9_])("+n+"\\()",e=new RegExp(t,"g"),r=r.replace(e,"$1document.getElementById(")),/^var _w=window,_n=navigator,_d=document;\n/.test(r)&&(r=(r=(r=(r=r.replace(/^var _w=window,_n=navigator,_d=document;\n/,"")).replace(/(^|[\s,\|&;\?\:\!=\[\(\{\)\}\+\#])(_n)(\W|$)/g,"$1navigator$3")).replace(/(^|[\s,\|&;\?\:\!=\[\(\{\)\}\+\#])(_d)(\W|$)/g,"$1document$3")).replace(/(^|[\s,\|&;\?\:\!=\[\(\{\)\}\+\#])(_w)(\W|$)/g,"$1window$3")),r};